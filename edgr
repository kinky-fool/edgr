#!/usr/bin/perl

use strict;
use warnings;

use Edgr;
use Getopt::Long;

my $config      = "$ENV{HOME}/.config/edgr";
my $settings    = read_config($config);

my $dbh = db_connect($$settings{database});
my $user = get_user($dbh, $$settings{user});

# Check if a session is allowed
if (deny_play($dbh, $user)) {
  exit;
}

my $session = init_session($dbh, $user);
store_session($dbh, $session);

while ($$user{time_max} > $$session{duration}) {
  make_beats($session);
}

write_script($session, $settings);
#play_script($session);
#save_session($session);
#
#score_sessions($session);
