#!/usr/bin/env python3

import time
import random
from playsound import playsound
import os

audio_dir = "%s/lib/audio" % os.environ['HOME']
edge_min = 7
edge_max = 60

def main():
  edges = int(input("Number of edges: "))

  warm_ups = [ 6, 6, 6, 6, 6, 9, 9, 9, 9, 12, 12, 15 ]

  time.sleep(random.choice(warm_ups) * 60)

  play_rand_sound(audio_dir + "/get-ready")
  print("Get ready!")

  while edges > 0:
    countdowns = [ 30, 30,
                   45, 45, 45, 45,
                   60, 60, 60, 60, 60, 60,
                   90, 90, 90 ]

    if random.randint(1,50) == 1:
      countdowns = [ x + 30 for x in countdowns ]

    if random.randint(1,50) == 1:
      countdowns = [ x + 30 for x in countdowns ]

    if random.randint(1,100) == 1:
      countdowns = [ x + 60 for x in countdowns ]

    time.sleep(random.choice(countdowns))

    play_rand_sound(audio_dir + "/edges")

    start = time.time()

    input("Press Enter once you get to the edge.")

    elapsed = time.time() - start

    if elapsed > edge_max:
      play_rand_sound(audio_dir + "/too-slow")
      print("Too slow, try again.")
    else:
      if elapsed > (edge_max - 1):
        print("That was close!")
      if elapsed > edge_min:
        edge_max = elapsed
      play_rand_sound(audio_dir + '/good-boy')
      print("Good boy.")
      edges = edges - 1

  # Done!
  time.sleep(10)
  print("You may stop stroking your cock.")
  play_rand_sound(audio_dir + '/stop')

def play_rand_sound(directory):
  if os.path.isdir(directory):
    filename = ''

    while not os.path.isfile(directory + '/' + filename):
      filename = random.choice(os.listdir(directory))

    playsound(directory + '/' + filename)

  return

if __name__ == '__main__':
  main()
