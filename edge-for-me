#!/usr/bin/env python3

import time
import random
from playsound import playsound
import os

audio_dir = "%s/lib/audio" % os.environ['HOME']

def main():
  edge_min = 7
  edge_max = 60

  edges = int(input("Number of edges: "))

  warm_ups = [ 6, 6, 6, 6, 6, 9, 9, 9, 9, 12, 12, 15 ]

  time.sleep(random.choice(warm_ups) * 60)


  while edges > 0:
    print("Hands off your cock.")
    play_rand_sound(audio_dir + "/hands-off")

    time.sleep(30)

    print("Get ready!")
    play_rand_sound(audio_dir + "/get-ready")

    countdowns = [ 15, 15,
                   30, 30, 30,
                   45, 45, 45, 45, 45,
                   60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60,
                   90, 90, 90,
                   120 ]

    laugh = 0
    for foo in range(0,3):
      if random.randint(1,30) == 1:
        countdowns = [ x + 30 for x in countdowns ]
        laugh = 1

    if laugh != 0:
      play_rand_sound(audio_dir + "/laughs")

    time.sleep(random.choice(countdowns))

    play_rand_sound(audio_dir + "/edges")

    start = time.time()

    input("Press Enter once you get to the edge.")

    elapsed = time.time() - start

    if elapsed > edge_max:
      print("Too slow, try again.")
      play_rand_sound(audio_dir + "/too-slow")
    else:
      if elapsed > edge_max - 1:
        print("That was close!")
      if elapsed > edge_min:
        edge_max = elapsed
      print("Good boy.")
      play_rand_sound(audio_dir + '/good-boy')
      edges = edges - 1

    time.sleep(10)

  # Done!
  print("You may stop stroking your cock.")
  play_rand_sound(audio_dir + '/stop')

def play_rand_sound(directory):
  if os.path.isdir(directory):
    filename = ''

    while not os.path.isfile(directory + '/' + filename):
      filename = random.choice(os.listdir(directory))

    playsound(directory + '/' + filename)

  return

if __name__ == '__main__':
  main()
